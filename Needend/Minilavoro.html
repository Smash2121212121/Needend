<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Minilavoro</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <span class="Mini">Mini</span><span class="work">lavori</span>
  <div id="risultato"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getFirestore, collection, query, orderBy, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAZB8-vpCBKH-cG8VOrn0CWgCL6k4hR_HM",
      authDomain: "needend-538ab.firebaseapp.com",
      projectId: "needend-538ab",
      storageBucket: "needend-538ab.firebasestorage.app",
      messagingSenderId: "18978302731",
      appId: "1:18978302731:web:d2543654b74953382f500e",
      measurementId: "G-1M35078DYX"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const container = document.getElementById("risultato");

    const q = query(collection(db, "bisogni"), orderBy("timestamp", "desc"));

    onSnapshot(q, (snapshot) => {
      container.innerHTML = "";
      snapshot.forEach((doc) => {
        const data = doc.data();

        const div = document.createElement("div");
        div.className = "lavoro-container";

        div.innerHTML = `
          <h3>Bisogno: ${data.bisogno}</h3>
          <div class="ricompensa">Ricompensa: ${data.ricompensa}â‚¬</div>
          <div class="durata">Durata: ${data.durata}</div>
          <div>Descrizione: ${data.descrizione}</div>
          <div><input type="button" value="Accetta" data-id="${doc.id}"></div>
        `;

        div.querySelector("input").addEventListener("click", async () => {
          alert("Hai accettato il lavoro");
          try {
            await deleteDoc(doc(db, "bisogni", doc.id));
            console.log("Lavoro rimosso");
          } catch (error) {
            console.error("Errore nella rimozione:", error);
          }
        });

        container.appendChild(div);
      });
    });
  </script>
</body>
</html>

