<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
import { getFirestore, collection, query, orderBy, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAZB8-vpCBKH-cG8VOrn0CWgCL6k4hR_HM",
  authDomain: "needend-538ab.firebaseapp.com",
  projectId: "needend-538ab",
  storageBucket: "needend-538ab.firebasestorage.app",
  messagingSenderId: "18978302731",
  appId: "1:18978302731:web:d2543654b74953382f500e",
  measurementId: "G-1M35078DYX"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("risultato");
const q = query(collection(db, "bisogni"), orderBy("timestamp", "desc"));

// Funzione per eliminare un documento
async function eliminaDocumento(docID) {
  try {
    await deleteDoc(doc(db, "bisogni", docID));
    console.log("Documento eliminato:", docID);
  } catch (err) {
    console.error("Errore eliminazione:", err);
  }
}

// Stampa bisogni + aggiunge tasto accetta
onSnapshot(q, (snapshot) => {
  container.innerHTML = "";
  snapshot.forEach((docSnap) => {
    const data = docSnap.data();

    // CREA elemento HTML
    const div = document.createElement("div");
    div.className = "lavoro-container";
    div.innerHTML = `
      <h3>Bisogno: ${data.bisogno}</h3>
      <div class="ricompensa">Ricompensa: ${data.ricompensa}â‚¬</div>
      <div class="durata">Durata: ${data.durata}</div>
      <div>Descrizione: ${data.descrizione}</div>
      <button data-id="${docSnap.id}">Accetta</button>
    `;

    // CLICK elimina
    div.querySelector("button").addEventListener("click", (e) => {
      alert("Hai accettato il lavoro");
      eliminaDocumento(e.target.dataset.id);
    });

    container.appendChild(div);
  });
});
</script>
